import{r as he,j as U}from"./index-ChMVtb9D.js";import{B as Ee}from"./index-DXLj9f1R.js";import{r as lt}from"./jszip.min-kDnLfYKw.js";import{c as st,j as ut,k as ct}from"./index-DZail4WS.js";import{r as ft,i as dt}from"./INVOICE-Bbpq3xD1.js";import{I as Se,a as Oe}from"./constants-C60o2bYF.js";import{B as Fe}from"./button-BnUoqwq8.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";var _e={},te={},ce={},We;function mt(){if(We)return ce;We=1;var I=ce&&ce.__importDefault||function(w){return w&&w.__esModule?w:{default:w}};Object.defineProperty(ce,"__esModule",{value:!0}),ce.zipSave=ce.zipSetText=ce.zipGetText=ce.zipLoad=void 0;var C=I(lt()),k=function(w){return C.default.loadAsync(w)};ce.zipLoad=k;var L=function(w,_){var b=w.file(_);return b?b.async("text"):null};ce.zipGetText=L;var M=function(w,_,b){return w.file(_,b,{binary:!1})};ce.zipSetText=M;var A=function(w,_){return w.generateAsync({type:"uint8array",compression:"DEFLATE",compressionOptions:{level:_}})};return ce.zipSave=A,ce}var Te={},Ge={},Qe;function pt(){return Qe||(Qe=1,(function(I){(function(C){C.parser=function(t,e){return new L(t,e)},C.SAXParser=L,C.SAXStream=T,C.createStream=R,C.MAX_BUFFER_LENGTH=64*1024;var k=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];C.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"];function L(t,e){if(!(this instanceof L))return new L(t,e);var u=this;A(u),u.q=u.c="",u.bufferCheckPosition=C.MAX_BUFFER_LENGTH,u.opt=e||{},u.opt.lowercase=u.opt.lowercase||u.opt.lowercasetags,u.looseCase=u.opt.lowercase?"toLowerCase":"toUpperCase",u.tags=[],u.closed=u.closedRoot=u.sawRoot=!1,u.tag=u.error=null,u.strict=!!t,u.noscript=!!(t||u.opt.noscript),u.state=l.BEGIN,u.strictEntities=u.opt.strictEntities,u.ENTITIES=u.strictEntities?Object.create(C.XML_ENTITIES):Object.create(C.ENTITIES),u.attribList=[],u.opt.xmlns&&(u.ns=Object.create(x)),u.trackPosition=u.opt.position!==!1,u.trackPosition&&(u.position=u.line=u.column=0),pe(u,"onready")}Object.create||(Object.create=function(t){function e(){}e.prototype=t;var u=new e;return u}),Object.keys||(Object.keys=function(t){var e=[];for(var u in t)t.hasOwnProperty(u)&&e.push(u);return e});function M(t){for(var e=Math.max(C.MAX_BUFFER_LENGTH,10),u=0,r=0,D=k.length;r<D;r++){var F=t[k[r]].length;if(F>e)switch(k[r]){case"textNode":y(t);break;case"cdata":Z(t,"oncdata",t.cdata),t.cdata="";break;case"script":Z(t,"onscript",t.script),t.script="";break;default:N(t,"Max buffer length exceeded: "+k[r])}u=Math.max(u,F)}var B=C.MAX_BUFFER_LENGTH-u;t.bufferCheckPosition=B+t.position}function A(t){for(var e=0,u=k.length;e<u;e++)t[k[e]]=""}function w(t){y(t),t.cdata!==""&&(Z(t,"oncdata",t.cdata),t.cdata=""),t.script!==""&&(Z(t,"onscript",t.script),t.script="")}L.prototype={end:function(){S(this)},write:v,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){w(this)}};var _;try{_=st().Stream}catch{_=function(){}}_||(_=function(){});var b=C.EVENTS.filter(function(t){return t!=="error"&&t!=="end"});function R(t,e){return new T(t,e)}function T(t,e){if(!(this instanceof T))return new T(t,e);_.apply(this),this._parser=new L(t,e),this.writable=!0,this.readable=!0;var u=this;this._parser.onend=function(){u.emit("end")},this._parser.onerror=function(r){u.emit("error",r),u._parser.error=null},this._decoder=null,b.forEach(function(r){Object.defineProperty(u,"on"+r,{get:function(){return u._parser["on"+r]},set:function(D){if(!D)return u.removeAllListeners(r),u._parser["on"+r]=D,D;u.on(r,D)},enumerable:!0,configurable:!1})})}T.prototype=Object.create(_.prototype,{constructor:{value:T}}),T.prototype.write=function(t){if(typeof Ee=="function"&&typeof Ee.isBuffer=="function"&&Ee.isBuffer(t)){if(!this._decoder){var e=ut().StringDecoder;this._decoder=new e("utf8")}t=this._decoder.write(t)}return this._parser.write(t.toString()),this.emit("data",t),!0},T.prototype.end=function(t){return t&&t.length&&this.write(t),this._parser.end(),!0},T.prototype.on=function(t,e){var u=this;return!u._parser["on"+t]&&b.indexOf(t)!==-1&&(u._parser["on"+t]=function(){var r=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);r.splice(0,0,t),u.emit.apply(u,r)}),_.prototype.on.call(u,t,e)};var E="[CDATA[",f="DOCTYPE",m="http://www.w3.org/XML/1998/namespace",d="http://www.w3.org/2000/xmlns/",x={xml:m,xmlns:d},O=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,W=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,j=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,Q=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function V(t){return t===" "||t===`
`||t==="\r"||t==="	"}function X(t){return t==='"'||t==="'"}function ae(t){return t===">"||V(t)}function G(t,e){return t.test(e)}function oe(t,e){return!G(t,e)}var l=0;C.STATE={BEGIN:l++,BEGIN_WHITESPACE:l++,TEXT:l++,TEXT_ENTITY:l++,OPEN_WAKA:l++,SGML_DECL:l++,SGML_DECL_QUOTED:l++,DOCTYPE:l++,DOCTYPE_QUOTED:l++,DOCTYPE_DTD:l++,DOCTYPE_DTD_QUOTED:l++,COMMENT_STARTING:l++,COMMENT:l++,COMMENT_ENDING:l++,COMMENT_ENDED:l++,CDATA:l++,CDATA_ENDING:l++,CDATA_ENDING_2:l++,PROC_INST:l++,PROC_INST_BODY:l++,PROC_INST_ENDING:l++,OPEN_TAG:l++,OPEN_TAG_SLASH:l++,ATTRIB:l++,ATTRIB_NAME:l++,ATTRIB_NAME_SAW_WHITE:l++,ATTRIB_VALUE:l++,ATTRIB_VALUE_QUOTED:l++,ATTRIB_VALUE_CLOSED:l++,ATTRIB_VALUE_UNQUOTED:l++,ATTRIB_VALUE_ENTITY_Q:l++,ATTRIB_VALUE_ENTITY_U:l++,CLOSE_TAG:l++,CLOSE_TAG_SAW_WHITE:l++,SCRIPT:l++,SCRIPT_ENDING:l++},C.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},C.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(C.ENTITIES).forEach(function(t){var e=C.ENTITIES[t],u=typeof e=="number"?String.fromCharCode(e):e;C.ENTITIES[t]=u});for(var be in C.STATE)C.STATE[C.STATE[be]]=be;l=C.STATE;function pe(t,e,u){t[e]&&t[e](u)}function Z(t,e,u){t.textNode&&y(t),pe(t,e,u)}function y(t){t.textNode=P(t.opt,t.textNode),t.textNode&&pe(t,"ontext",t.textNode),t.textNode=""}function P(t,e){return t.trim&&(e=e.trim()),t.normalize&&(e=e.replace(/\s+/g," ")),e}function N(t,e){return y(t),t.trackPosition&&(e+=`
Line: `+t.line+`
Column: `+t.column+`
Char: `+t.c),e=new Error(e),t.error=e,pe(t,"onerror",e),t}function S(t){return t.sawRoot&&!t.closedRoot&&a(t,"Unclosed root tag"),t.state!==l.BEGIN&&t.state!==l.BEGIN_WHITESPACE&&t.state!==l.TEXT&&N(t,"Unexpected end"),y(t),t.c="",t.closed=!0,pe(t,"onend"),L.call(t,t.strict,t.opt),t}function a(t,e){if(typeof t!="object"||!(t instanceof L))throw new Error("bad call to strictFail");t.strict&&N(t,e)}function o(t){t.strict||(t.tagName=t.tagName[t.looseCase]());var e=t.tags[t.tags.length-1]||t,u=t.tag={name:t.tagName,attributes:{}};t.opt.xmlns&&(u.ns=e.ns),t.attribList.length=0,Z(t,"onopentagstart",u)}function n(t,e){var u=t.indexOf(":"),r=u<0?["",t]:t.split(":"),D=r[0],F=r[1];return e&&t==="xmlns"&&(D="xmlns",F=""),{prefix:D,local:F}}function c(t){if(t.strict||(t.attribName=t.attribName[t.looseCase]()),t.attribList.indexOf(t.attribName)!==-1||t.tag.attributes.hasOwnProperty(t.attribName)){t.attribName=t.attribValue="";return}if(t.opt.xmlns){var e=n(t.attribName,!0),u=e.prefix,r=e.local;if(u==="xmlns")if(r==="xml"&&t.attribValue!==m)a(t,"xml: prefix must be bound to "+m+`
Actual: `+t.attribValue);else if(r==="xmlns"&&t.attribValue!==d)a(t,"xmlns: prefix must be bound to "+d+`
Actual: `+t.attribValue);else{var D=t.tag,F=t.tags[t.tags.length-1]||t;D.ns===F.ns&&(D.ns=Object.create(F.ns)),D.ns[r]=t.attribValue}t.attribList.push([t.attribName,t.attribValue])}else t.tag.attributes[t.attribName]=t.attribValue,Z(t,"onattribute",{name:t.attribName,value:t.attribValue});t.attribName=t.attribValue=""}function p(t,e){if(t.opt.xmlns){var u=t.tag,r=n(t.tagName);u.prefix=r.prefix,u.local=r.local,u.uri=u.ns[r.prefix]||"",u.prefix&&!u.uri&&(a(t,"Unbound namespace prefix: "+JSON.stringify(t.tagName)),u.uri=r.prefix);var D=t.tags[t.tags.length-1]||t;u.ns&&D.ns!==u.ns&&Object.keys(u.ns).forEach(function($){Z(t,"onopennamespace",{prefix:$,uri:u.ns[$]})});for(var F=0,B=t.attribList.length;F<B;F++){var z=t.attribList[F],Y=z[0],ne=z[1],q=n(Y,!0),K=q.prefix,H=q.local,le=K===""?"":u.ns[K]||"",ue={name:Y,value:ne,prefix:K,local:H,uri:le};K&&K!=="xmlns"&&!le&&(a(t,"Unbound namespace prefix: "+JSON.stringify(K)),ue.uri=K),t.tag.attributes[Y]=ue,Z(t,"onattribute",ue)}t.attribList.length=0}t.tag.isSelfClosing=!!e,t.sawRoot=!0,t.tags.push(t.tag),Z(t,"onopentag",t.tag),e||(!t.noscript&&t.tagName.toLowerCase()==="script"?t.state=l.SCRIPT:t.state=l.TEXT,t.tag=null,t.tagName=""),t.attribName=t.attribValue="",t.attribList.length=0}function i(t){if(!t.tagName){a(t,"Weird empty close tag."),t.textNode+="</>",t.state=l.TEXT;return}if(t.script){if(t.tagName!=="script"){t.script+="</"+t.tagName+">",t.tagName="",t.state=l.SCRIPT;return}Z(t,"onscript",t.script),t.script=""}var e=t.tags.length,u=t.tagName;t.strict||(u=u[t.looseCase]());for(var r=u;e--;){var D=t.tags[e];if(D.name!==r)a(t,"Unexpected close tag");else break}if(e<0){a(t,"Unmatched closing tag: "+t.tagName),t.textNode+="</"+t.tagName+">",t.state=l.TEXT;return}t.tagName=u;for(var F=t.tags.length;F-- >e;){var B=t.tag=t.tags.pop();t.tagName=t.tag.name,Z(t,"onclosetag",t.tagName);var z={};for(var Y in B.ns)z[Y]=B.ns[Y];var ne=t.tags[t.tags.length-1]||t;t.opt.xmlns&&B.ns!==ne.ns&&Object.keys(B.ns).forEach(function(q){var K=B.ns[q];Z(t,"onclosenamespace",{prefix:q,uri:K})})}e===0&&(t.closedRoot=!0),t.tagName=t.attribValue=t.attribName="",t.attribList.length=0,t.state=l.TEXT}function s(t){var e=t.entity,u=e.toLowerCase(),r,D="";return t.ENTITIES[e]?t.ENTITIES[e]:t.ENTITIES[u]?t.ENTITIES[u]:(e=u,e.charAt(0)==="#"&&(e.charAt(1)==="x"?(e=e.slice(2),r=parseInt(e,16),D=r.toString(16)):(e=e.slice(1),r=parseInt(e,10),D=r.toString(10))),e=e.replace(/^0+/,""),isNaN(r)||D.toLowerCase()!==e?(a(t,"Invalid character entity"),"&"+t.entity+";"):String.fromCodePoint(r))}function h(t,e){e==="<"?(t.state=l.OPEN_WAKA,t.startTagPosition=t.position):V(e)||(a(t,"Non-whitespace before first tag."),t.textNode=e,t.state=l.TEXT)}function g(t,e){var u="";return e<t.length&&(u=t.charAt(e)),u}function v(t){var e=this;if(this.error)throw this.error;if(e.closed)return N(e,"Cannot write after close. Assign an onready handler.");if(t===null)return S(e);typeof t=="object"&&(t=t.toString());for(var u=0,r="";r=g(t,u++),e.c=r,!!r;)switch(e.trackPosition&&(e.position++,r===`
`?(e.line++,e.column=0):e.column++),e.state){case l.BEGIN:if(e.state=l.BEGIN_WHITESPACE,r==="\uFEFF")continue;h(e,r);continue;case l.BEGIN_WHITESPACE:h(e,r);continue;case l.TEXT:if(e.sawRoot&&!e.closedRoot){for(var D=u-1;r&&r!=="<"&&r!=="&";)r=g(t,u++),r&&e.trackPosition&&(e.position++,r===`
`?(e.line++,e.column=0):e.column++);e.textNode+=t.substring(D,u-1)}r==="<"&&!(e.sawRoot&&e.closedRoot&&!e.strict)?(e.state=l.OPEN_WAKA,e.startTagPosition=e.position):(!V(r)&&(!e.sawRoot||e.closedRoot)&&a(e,"Text data outside of root node."),r==="&"?e.state=l.TEXT_ENTITY:e.textNode+=r);continue;case l.SCRIPT:r==="<"?e.state=l.SCRIPT_ENDING:e.script+=r;continue;case l.SCRIPT_ENDING:r==="/"?e.state=l.CLOSE_TAG:(e.script+="<"+r,e.state=l.SCRIPT);continue;case l.OPEN_WAKA:if(r==="!")e.state=l.SGML_DECL,e.sgmlDecl="";else if(!V(r))if(G(O,r))e.state=l.OPEN_TAG,e.tagName=r;else if(r==="/")e.state=l.CLOSE_TAG,e.tagName="";else if(r==="?")e.state=l.PROC_INST,e.procInstName=e.procInstBody="";else{if(a(e,"Unencoded <"),e.startTagPosition+1<e.position){var F=e.position-e.startTagPosition;r=new Array(F).join(" ")+r}e.textNode+="<"+r,e.state=l.TEXT}continue;case l.SGML_DECL:(e.sgmlDecl+r).toUpperCase()===E?(Z(e,"onopencdata"),e.state=l.CDATA,e.sgmlDecl="",e.cdata=""):e.sgmlDecl+r==="--"?(e.state=l.COMMENT,e.comment="",e.sgmlDecl=""):(e.sgmlDecl+r).toUpperCase()===f?(e.state=l.DOCTYPE,(e.doctype||e.sawRoot)&&a(e,"Inappropriately located doctype declaration"),e.doctype="",e.sgmlDecl=""):r===">"?(Z(e,"onsgmldeclaration",e.sgmlDecl),e.sgmlDecl="",e.state=l.TEXT):(X(r)&&(e.state=l.SGML_DECL_QUOTED),e.sgmlDecl+=r);continue;case l.SGML_DECL_QUOTED:r===e.q&&(e.state=l.SGML_DECL,e.q=""),e.sgmlDecl+=r;continue;case l.DOCTYPE:r===">"?(e.state=l.TEXT,Z(e,"ondoctype",e.doctype),e.doctype=!0):(e.doctype+=r,r==="["?e.state=l.DOCTYPE_DTD:X(r)&&(e.state=l.DOCTYPE_QUOTED,e.q=r));continue;case l.DOCTYPE_QUOTED:e.doctype+=r,r===e.q&&(e.q="",e.state=l.DOCTYPE);continue;case l.DOCTYPE_DTD:e.doctype+=r,r==="]"?e.state=l.DOCTYPE:X(r)&&(e.state=l.DOCTYPE_DTD_QUOTED,e.q=r);continue;case l.DOCTYPE_DTD_QUOTED:e.doctype+=r,r===e.q&&(e.state=l.DOCTYPE_DTD,e.q="");continue;case l.COMMENT:r==="-"?e.state=l.COMMENT_ENDING:e.comment+=r;continue;case l.COMMENT_ENDING:r==="-"?(e.state=l.COMMENT_ENDED,e.comment=P(e.opt,e.comment),e.comment&&Z(e,"oncomment",e.comment),e.comment=""):(e.comment+="-"+r,e.state=l.COMMENT);continue;case l.COMMENT_ENDED:r!==">"?(a(e,"Malformed comment"),e.comment+="--"+r,e.state=l.COMMENT):e.state=l.TEXT;continue;case l.CDATA:r==="]"?e.state=l.CDATA_ENDING:e.cdata+=r;continue;case l.CDATA_ENDING:r==="]"?e.state=l.CDATA_ENDING_2:(e.cdata+="]"+r,e.state=l.CDATA);continue;case l.CDATA_ENDING_2:r===">"?(e.cdata&&Z(e,"oncdata",e.cdata),Z(e,"onclosecdata"),e.cdata="",e.state=l.TEXT):r==="]"?e.cdata+="]":(e.cdata+="]]"+r,e.state=l.CDATA);continue;case l.PROC_INST:r==="?"?e.state=l.PROC_INST_ENDING:V(r)?e.state=l.PROC_INST_BODY:e.procInstName+=r;continue;case l.PROC_INST_BODY:if(!e.procInstBody&&V(r))continue;r==="?"?e.state=l.PROC_INST_ENDING:e.procInstBody+=r;continue;case l.PROC_INST_ENDING:r===">"?(Z(e,"onprocessinginstruction",{name:e.procInstName,body:e.procInstBody}),e.procInstName=e.procInstBody="",e.state=l.TEXT):(e.procInstBody+="?"+r,e.state=l.PROC_INST_BODY);continue;case l.OPEN_TAG:G(W,r)?e.tagName+=r:(o(e),r===">"?p(e):r==="/"?e.state=l.OPEN_TAG_SLASH:(V(r)||a(e,"Invalid character in tag name"),e.state=l.ATTRIB));continue;case l.OPEN_TAG_SLASH:r===">"?(p(e,!0),i(e)):(a(e,"Forward-slash in opening tag not followed by >"),e.state=l.ATTRIB);continue;case l.ATTRIB:if(V(r))continue;r===">"?p(e):r==="/"?e.state=l.OPEN_TAG_SLASH:G(O,r)?(e.attribName=r,e.attribValue="",e.state=l.ATTRIB_NAME):a(e,"Invalid attribute name");continue;case l.ATTRIB_NAME:r==="="?e.state=l.ATTRIB_VALUE:r===">"?(a(e,"Attribute without value"),e.attribValue=e.attribName,c(e),p(e)):V(r)?e.state=l.ATTRIB_NAME_SAW_WHITE:G(W,r)?e.attribName+=r:a(e,"Invalid attribute name");continue;case l.ATTRIB_NAME_SAW_WHITE:if(r==="=")e.state=l.ATTRIB_VALUE;else{if(V(r))continue;a(e,"Attribute without value"),e.tag.attributes[e.attribName]="",e.attribValue="",Z(e,"onattribute",{name:e.attribName,value:""}),e.attribName="",r===">"?p(e):G(O,r)?(e.attribName=r,e.state=l.ATTRIB_NAME):(a(e,"Invalid attribute name"),e.state=l.ATTRIB)}continue;case l.ATTRIB_VALUE:if(V(r))continue;X(r)?(e.q=r,e.state=l.ATTRIB_VALUE_QUOTED):(a(e,"Unquoted attribute value"),e.state=l.ATTRIB_VALUE_UNQUOTED,e.attribValue=r);continue;case l.ATTRIB_VALUE_QUOTED:if(r!==e.q){r==="&"?e.state=l.ATTRIB_VALUE_ENTITY_Q:e.attribValue+=r;continue}c(e),e.q="",e.state=l.ATTRIB_VALUE_CLOSED;continue;case l.ATTRIB_VALUE_CLOSED:V(r)?e.state=l.ATTRIB:r===">"?p(e):r==="/"?e.state=l.OPEN_TAG_SLASH:G(O,r)?(a(e,"No whitespace between attributes"),e.attribName=r,e.attribValue="",e.state=l.ATTRIB_NAME):a(e,"Invalid attribute name");continue;case l.ATTRIB_VALUE_UNQUOTED:if(!ae(r)){r==="&"?e.state=l.ATTRIB_VALUE_ENTITY_U:e.attribValue+=r;continue}c(e),r===">"?p(e):e.state=l.ATTRIB;continue;case l.CLOSE_TAG:if(e.tagName)r===">"?i(e):G(W,r)?e.tagName+=r:e.script?(e.script+="</"+e.tagName,e.tagName="",e.state=l.SCRIPT):(V(r)||a(e,"Invalid tagname in closing tag"),e.state=l.CLOSE_TAG_SAW_WHITE);else{if(V(r))continue;oe(O,r)?e.script?(e.script+="</"+r,e.state=l.SCRIPT):a(e,"Invalid tagname in closing tag."):e.tagName=r}continue;case l.CLOSE_TAG_SAW_WHITE:if(V(r))continue;r===">"?i(e):a(e,"Invalid characters in closing tag");continue;case l.TEXT_ENTITY:case l.ATTRIB_VALUE_ENTITY_Q:case l.ATTRIB_VALUE_ENTITY_U:var B,z;switch(e.state){case l.TEXT_ENTITY:B=l.TEXT,z="textNode";break;case l.ATTRIB_VALUE_ENTITY_Q:B=l.ATTRIB_VALUE_QUOTED,z="attribValue";break;case l.ATTRIB_VALUE_ENTITY_U:B=l.ATTRIB_VALUE_UNQUOTED,z="attribValue";break}if(r===";")if(e.opt.unparsedEntities){var Y=s(e);e.entity="",e.state=B,e.write(Y)}else e[z]+=s(e),e.entity="",e.state=B;else G(e.entity.length?Q:j,r)?e.entity+=r:(a(e,"Invalid character in entity name"),e[z]+="&"+e.entity+r,e.entity="",e.state=B);continue;default:throw new Error(e,"Unknown state: "+e.state)}return e.position>=e.bufferCheckPosition&&M(e),e}String.fromCodePoint||(function(){var t=String.fromCharCode,e=Math.floor,u=function(){var r=16384,D=[],F,B,z=-1,Y=arguments.length;if(!Y)return"";for(var ne="";++z<Y;){var q=Number(arguments[z]);if(!isFinite(q)||q<0||q>1114111||e(q)!==q)throw RangeError("Invalid code point: "+q);q<=65535?D.push(q):(q-=65536,F=(q>>10)+55296,B=q%1024+56320,D.push(F,B)),(z+1===Y||D.length>r)&&(ne+=t.apply(null,D),D.length=0)}return ne};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:u,configurable:!0,writable:!0}):String.fromCodePoint=u})()})(I)})(Ge)),Ge}var qe={},Je;function Le(){return Je||(Je=1,(function(I){Object.defineProperty(I,"__esModule",{value:!0}),I.setDebugLogSink=I.logger=void 0,I.logger={debug:function(){}};function C(k){I.logger.debug=k}I.setDebugLogSink=C})(qe)),qe}var Ye;function gt(){if(Ye)return Te;Ye=1;var I=Te&&Te.__importDefault||function(_){return _&&_.__esModule?_:{default:_}};Object.defineProperty(Te,"__esModule",{value:!0}),Te.buildXml=Te.parseXml=void 0;var C=I(pt()),k=Le(),L=function(_){var b=C.default.parser(!0,{trim:!1,normalize:!1}),R,T=null,E=0;return new Promise(function(f,m){b.onopentag=function(d){var x={_parent:T||void 0,_children:[],_fTextNode:!1,_tag:d.name,_attrs:d.attributes};T!=null?T._children.push(x):R=x,T=x,E+=1},b.onclosetag=function(){T=T!=null?T._parent:null},b.ontext=function(d){T?._children.push({_parent:T,_children:[],_fTextNode:!0,_text:d})},b.onend=function(){k.logger.debug("Number of XML elements: ".concat(E)),f(R)},b.onerror=function(d){m(d)},b.write(_),b.end()})};Te.parseXml=L;function M(_,b,R,T){R===void 0&&(R=""),T===void 0&&(T=!0);var E=R.length||!T?"":'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>',f=[Ee.from(E,"utf-8")];if(_._fTextNode)f.push(Ee.from(A(_._text,b)));else{var m="",d=_._attrs;Object.keys(d).forEach(function(V){m+=" ".concat(V,'="').concat(w(d[V]),'"')});var x=_._children.length>0,O=x?"":"/",W=b.indentXml?`
`.concat(R):"";f.push(Ee.from("".concat(W,"<").concat(_._tag).concat(m).concat(O,">")));var j=!1;if(_._children.forEach(function(V){f.push(M(V,b,b.indentXml?"".concat(R,"  "):"",!1)),j=!V._fTextNode}),x){var Q=b.indentXml&&j?`
`.concat(R):"";f.push(Ee.from("".concat(Q,"</").concat(_._tag,">")))}}return Ee.concat(f)}Te.buildXml=M;var A=function(_,b){for(var R="",T=_.split(b.literalXmlDelimiter),E=!1,f=0;f<T.length;f++){var m=T[f];E||(m=m.replace(/&/g,"&amp;"),m=m.replace(/</g,"&lt;"),m=m.replace(/>/g,"&gt;")),R+=m,E=!E}return R},w=function(_){var b=typeof _=="string"?_:_.value;return b=b.replace(/&/g,"&amp;"),b=b.replace(/</g,"&lt;"),b=b.replace(/>/g,"&gt;"),b=b.replace(/'/g,"&apos;"),b=b.replace(/"/g,"&quot;"),b};return Te}var Pe={},re={},J={},Ze;function Re(){if(Ze)return J;Ze=1;var I=J&&J.__extends||(function(){var f=function(m,d){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(x,O){x.__proto__=O}||function(x,O){for(var W in O)Object.prototype.hasOwnProperty.call(O,W)&&(x[W]=O[W])},f(m,d)};return function(m,d){if(typeof d!="function"&&d!==null)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");f(m,d);function x(){this.constructor=m}m.prototype=d===null?Object.create(d):(x.prototype=d.prototype,new x)}})();Object.defineProperty(J,"__esModule",{value:!0}),J.UnterminatedForLoopError=J.IncompleteConditionalStatementError=J.TemplateParseError=J.InternalError=J.ImageError=J.CommandExecutionError=J.InvalidCommandError=J.CommandSyntaxError=J.ObjectCommandResultError=J.NullishCommandResultError=J.isError=void 0;function C(f){return f instanceof Error||typeof f=="object"&&!!f&&"name"in f&&"message"in f}J.isError=C;var k=(function(f){I(m,f);function m(d){var x=f.call(this,"Result of command ".concat(d," is null or undefined and rejectNullish is set"))||this;return Object.setPrototypeOf(x,m.prototype),x.command=d,x}return m})(Error);J.NullishCommandResultError=k;var L=(function(f){I(m,f);function m(d,x){var O=f.call(this,"Result of command '".concat(d,"' is an object"))||this;return Object.setPrototypeOf(O,m.prototype),O.command=d,O.result=x,O}return m})(Error);J.ObjectCommandResultError=L;var M=(function(f){I(m,f);function m(d){var x=f.call(this,"Invalid command syntax: ".concat(d))||this;return Object.setPrototypeOf(x,m.prototype),x.command=d,x}return m})(Error);J.CommandSyntaxError=M;var A=(function(f){I(m,f);function m(d,x){var O=f.call(this,"".concat(d,": ").concat(x))||this;return Object.setPrototypeOf(O,m.prototype),O.command=x,O}return m})(Error);J.InvalidCommandError=A;var w=(function(f){I(m,f);function m(d,x){var O=f.call(this,"Error executing command '".concat(x,"': ").concat(d.name,": ").concat(d.message))||this;return Object.setPrototypeOf(O,m.prototype),O.command=x,O.err=d,O}return m})(Error);J.CommandExecutionError=w;var _=(function(f){I(m,f);function m(){return f!==null&&f.apply(this,arguments)||this}return m})(w);J.ImageError=_;var b=(function(f){I(m,f);function m(d){return f.call(this,"INTERNAL ERROR: ".concat(d))||this}return m})(Error);J.InternalError=b;var R=(function(f){I(m,f);function m(){return f!==null&&f.apply(this,arguments)||this}return m})(Error);J.TemplateParseError=R;var T=(function(f){I(m,f);function m(){return f.call(this,"Incomplete IF/END-IF statement. Make sure each IF-statement has a corresponding END-IF command.")||this}return m})(Error);J.IncompleteConditionalStatementError=T;var E=(function(f){I(m,f);function m(d){return f.call(this,"Unterminated FOR-loop ('FOR ".concat(d.varName,"'). Make sure each FOR loop has a corresponding END-FOR command."))||this}return m})(Error);return J.UnterminatedForLoopError=E,J}var Ke;function je(){if(Ke)return re;Ke=1,Object.defineProperty(re,"__esModule",{value:!0}),re.logLoop=re.isLoopExploring=re.getCurLoop=re.addChild=re.newTextNode=re.newNonTextNode=re.insertTextSiblingAfter=re.getNextSibling=re.cloneNodeWithoutChildren=void 0;var I=Re(),C=Le(),k=function(E){return E._fTextNode?{_children:[],_fTextNode:!0,_text:E._text}:{_children:[],_fTextNode:!1,_tag:E._tag,_attrs:E._attrs}};re.cloneNodeWithoutChildren=k;var L=function(E){var f=E._parent;if(f==null)return null;var m=f._children,d=m.indexOf(E);return d<0||d>=m.length-1?null:m[d+1]};re.getNextSibling=L;var M=function(E){var f=E._parent;if(!(f&&!f._fTextNode&&f._tag==="w:t"))throw new I.TemplateParseError("Template syntax error: text node not within w:t");var m=f._parent;if(m==null)throw new I.TemplateParseError("Template syntax error: w:t node has no parent");var d=m._children.indexOf(f);if(d<0)throw new I.TemplateParseError("Template syntax error");var x=k(f);x._parent=m;var O={_parent:x,_children:[],_fTextNode:!0,_text:""};return x._children=[O],m._children.splice(d+1,0,x),O};re.insertTextSiblingAfter=M;var A=function(E,f,m){f===void 0&&(f={}),m===void 0&&(m=[]);var d={_fTextNode:!1,_tag:E,_attrs:f,_children:m};return d._children.forEach(function(x){x._parent=d}),d};re.newNonTextNode=A;var w=function(E){var f={_children:[],_fTextNode:!0,_text:E};return f};re.newTextNode=w;var _=function(E,f){return E._children.push(f),f._parent=E,f};re.addChild=_;var b=function(E){return E.loops.length?E.loops[E.loops.length-1]:null};re.getCurLoop=b;var R=function(E){var f=b(E);return f!=null&&f.idx<0};re.isLoopExploring=R;var T=function(E){if(E.length){var f=E.length-1,m=E[f],d=m.varName,x=m.idx,O=m.loopOver,W=m.isIf,j=x>=0?x+1:"EXPLORATION";C.logger.debug("".concat(W?"IF":"FOR"," loop ")+"on ".concat(f,":").concat(d)+"".concat(j,"/").concat(O.length))}};return re.logLoop=T,re}var $e;function ht(){if($e)return Pe;$e=1,Object.defineProperty(Pe,"__esModule",{value:!0});var I=je(),C=function(k,L,M){for(var A=k,w=!1,_=null,b=0,R="".concat(L[0],"CMD_NODE").concat(L[1]);A!=null;){if(M&&!A._fTextNode&&A._tag==="w:t"&&(A._attrs["xml:space"]="preserve"),!A._fTextNode&&A._tag==="w:p"&&_&&(_._text+=" "),A._fTextNode&&A._parent&&!A._parent._fTextNode&&A._parent._tag==="w:t"){_==null&&(_=A);var T=A._text;A._text="";for(var E=0;E<T.length;E++){var f=T[E],m=w?L[1]:L[0];if(f===m[b]){if(b+=1,b===m.length){w=!w;var d=A===_;w&&_._text.length&&(_=(0,I.insertTextSiblingAfter)(_),d&&(A=_)),_._text+=m,!w&&E<T.length-1&&(_=(0,I.insertTextSiblingAfter)(_),d&&(A=_)),b=0,w||(_=A)}}else b&&(_._text+=m.slice(0,b),b=0,w||(_=A)),_._text+=f}!w&&!b&&(_=null),T.length&&!A._text.length&&(A._text=R)}if(A._children.length)A=A._children[0];else{for(var x=!1;A._parent!=null;){var O=A._parent,W=(0,I.getNextSibling)(A);if(W){x=!0,A=W;break}A=O}x||(A=null)}}return k};return Pe.default=C,Pe}var ee={},fe={},et;function vt(){if(et)return fe;et=1;var I=fe&&fe.__assign||function(){return I=Object.assign||function(R){for(var T,E=1,f=arguments.length;E<f;E++){T=arguments[E];for(var m in T)Object.prototype.hasOwnProperty.call(T,m)&&(R[m]=T[m])}return R},I.apply(this,arguments)},C=fe&&fe.__awaiter||function(R,T,E,f){function m(d){return d instanceof E?d:new E(function(x){x(d)})}return new(E||(E=Promise))(function(d,x){function O(Q){try{j(f.next(Q))}catch(V){x(V)}}function W(Q){try{j(f.throw(Q))}catch(V){x(V)}}function j(Q){Q.done?d(Q.value):m(Q.value).then(O,W)}j((f=f.apply(R,T||[])).next())})},k=fe&&fe.__generator||function(R,T){var E={label:0,sent:function(){if(d[0]&1)throw d[1];return d[1]},trys:[],ops:[]},f,m,d,x;return x={next:O(0),throw:O(1),return:O(2)},typeof Symbol=="function"&&(x[Symbol.iterator]=function(){return this}),x;function O(j){return function(Q){return W([j,Q])}}function W(j){if(f)throw new TypeError("Generator is already executing.");for(;x&&(x=0,j[0]&&(E=0)),E;)try{if(f=1,m&&(d=j[0]&2?m.return:j[0]?m.throw||((d=m.return)&&d.call(m),0):m.next)&&!(d=d.call(m,j[1])).done)return d;switch(m=0,d&&(j=[j[0]&2,d.value]),j[0]){case 0:case 1:d=j;break;case 4:return E.label++,{value:j[1],done:!1};case 5:E.label++,m=j[1],j=[0];continue;case 7:j=E.ops.pop(),E.trys.pop();continue;default:if(d=E.trys,!(d=d.length>0&&d[d.length-1])&&(j[0]===6||j[0]===2)){E=0;continue}if(j[0]===3&&(!d||j[1]>d[0]&&j[1]<d[3])){E.label=j[1];break}if(j[0]===6&&E.label<d[1]){E.label=d[1],d=j;break}if(d&&E.label<d[2]){E.label=d[2],E.ops.push(j);break}d[2]&&E.ops.pop(),E.trys.pop();continue}j=T.call(R,E)}catch(Q){j=[6,Q],m=0}finally{f=d=0}if(j[0]&5)throw j[1];return{value:j[0]?j[1]:void 0,done:!0}}},L=fe&&fe.__importDefault||function(R){return R&&R.__esModule?R:{default:R}};Object.defineProperty(fe,"__esModule",{value:!0}),fe.runUserJsAndGetRaw=void 0;var M=L(ct()),A=je(),w=Re(),_=Le();function b(R,T,E){return C(this,void 0,void 0,function(){var f,m,d,x,O,W,j,Q,V,X,ae;return k(this,function(G){switch(G.label){case 0:f=I(I(I(I({},E.jsSandbox||{}),{__code__:T,__result__:void 0}),R),E.options.additionalJsContext),m=(0,A.getCurLoop)(E),m&&(f.$idx=m.idx),Object.keys(E.vars).forEach(function(oe){f["$".concat(oe)]=E.vars[oe]}),G.label=1;case 1:return G.trys.push([1,8,,12]),E.options.runJs?(O=E.options.runJs({sandbox:f,ctx:E}),d=O.modifiedSandbox,[4,O.result]):[3,3];case 2:return x=G.sent(),[3,7];case 3:return E.options.noSandbox?(d=f,W=new Function("with(this) { return eval(__code__); }"),[4,W.call(d)]):[3,5];case 4:return x=G.sent(),[3,7];case 5:return j=new M.default.Script((ae=f.__code__)!==null&&ae!==void 0?ae:""),d=M.default.createContext(f),[4,j.runInContext(d)];case 6:x=G.sent(),G.label=7;case 7:return[3,12];case 8:return Q=G.sent(),V=(0,w.isError)(Q)?Q:new Error("".concat(Q)),E.options.errorHandler==null?[3,10]:(d=f,[4,E.options.errorHandler(V,T)]);case 9:return x=G.sent(),[3,11];case 10:throw new w.CommandExecutionError(V,T);case 11:return[3,12];case 12:return E.options.rejectNullish&&x==null?(X=new w.NullishCommandResultError(T),E.options.errorHandler==null?[3,14]:[4,E.options.errorHandler(X,T)]):[3,15];case 13:return x=G.sent(),[3,15];case 14:throw X;case 15:return E.jsSandbox=I(I({},d),{__code__:void 0,__result__:void 0}),_.logger.debug("Command returned: ",x),[2,x]}})})}return fe.runUserJsAndGetRaw=b,fe}var xe={},tt;function _t(){return tt||(tt=1,Object.defineProperty(xe,"__esModule",{value:!0}),xe.BUILT_IN_COMMANDS=xe.ImageExtensions=void 0,xe.ImageExtensions=[".png",".gif",".jpg",".jpeg",".svg"],xe.BUILT_IN_COMMANDS=["QUERY","CMD_NODE","ALIAS","FOR","END-FOR","IF","END-IF","INS","EXEC","IMAGE","LINK","HTML"]),xe}var nt;function Tt(){if(nt)return ee;nt=1;var I=ee&&ee.__assign||function(){return I=Object.assign||function(a){for(var o,n=1,c=arguments.length;n<c;n++){o=arguments[n];for(var p in o)Object.prototype.hasOwnProperty.call(o,p)&&(a[p]=o[p])}return a},I.apply(this,arguments)},C=ee&&ee.__awaiter||function(a,o,n,c){function p(i){return i instanceof n?i:new n(function(s){s(i)})}return new(n||(n=Promise))(function(i,s){function h(t){try{v(c.next(t))}catch(e){s(e)}}function g(t){try{v(c.throw(t))}catch(e){s(e)}}function v(t){t.done?i(t.value):p(t.value).then(h,g)}v((c=c.apply(a,o||[])).next())})},k=ee&&ee.__generator||function(a,o){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},c,p,i,s;return s={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function h(v){return function(t){return g([v,t])}}function g(v){if(c)throw new TypeError("Generator is already executing.");for(;s&&(s=0,v[0]&&(n=0)),n;)try{if(c=1,p&&(i=v[0]&2?p.return:v[0]?p.throw||((i=p.return)&&i.call(p),0):p.next)&&!(i=i.call(p,v[1])).done)return i;switch(p=0,i&&(v=[v[0]&2,i.value]),v[0]){case 0:case 1:i=v;break;case 4:return n.label++,{value:v[1],done:!1};case 5:n.label++,p=v[1],v=[0];continue;case 7:v=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(v[0]===6||v[0]===2)){n=0;continue}if(v[0]===3&&(!i||v[1]>i[0]&&v[1]<i[3])){n.label=v[1];break}if(v[0]===6&&n.label<i[1]){n.label=i[1],i=v;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(v);break}i[2]&&n.ops.pop(),n.trys.pop();continue}v=o.call(a,n)}catch(t){v=[6,t],p=0}finally{c=i=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}};Object.defineProperty(ee,"__esModule",{value:!0}),ee.splitCommand=ee.getCommand=ee.walkTemplate=ee.findHighestImgId=ee.produceJsReport=ee.extractQuery=ee.newContext=void 0;var L=je(),M=vt(),A=_t(),w=Re(),_=Le();function b(a,o){return o===void 0&&(o=0),{gCntIf:0,gCntEndIf:0,level:1,fCmd:!1,cmd:"",fSeekQuery:!1,buffers:{"w:p":{text:"",cmds:"",fInsertedText:!1},"w:tr":{text:"",cmds:"",fInsertedText:!1},"w:tc":{text:"",cmds:"",fInsertedText:!1}},imageAndShapeIdIncrement:o,images:{},linkId:0,links:{},htmlId:0,htmls:{},vars:{},loops:[],fJump:!1,shorthands:{},options:a,pIfCheckMap:new Map,trIfCheckMap:new Map}}ee.newContext=b;function R(a,o){return C(this,void 0,void 0,function(){var n,c,p,i,s,h;return k(this,function(g){switch(g.label){case 0:n=b(o),n.fSeekQuery=!0,c=a,g.label=1;case 1:if(c._children.length)c=c._children[0];else{for(p=!1;c._parent!=null;){if(i=c._parent,s=(0,L.getNextSibling)(c),s){c=s,p=!0;break}c=i}if(!p)return[3,4]}return c?(h=c._parent,c._fTextNode&&h&&!h._fTextNode&&h._tag==="w:t"?[4,x(null,c,n,O)]:[3,3]):[3,4];case 2:g.sent(),g.label=3;case 3:return n.query!=null?[3,4]:[3,1];case 4:return[2,n.query]}})})}ee.extractQuery=R;function T(a,o,n){return C(this,void 0,void 0,function(){return k(this,function(c){return[2,d(a,o,n,O)]})})}ee.produceJsReport=T;function E(a){var o=[],n=function(c){for(var p=0,i=c._children;p<i.length;p++){var s=i[p],h=s._fTextNode?null:s._tag;if(h!=null){if(h==="wp:docPr"){if(s._fTextNode)continue;var g=s._attrs.id;if(typeof g!="string")continue;var v=Number.parseInt(g,10);Number.isSafeInteger(v)&&o.push(v)}s._children.length>0&&n(s)}}};return n(a),o.length>0?Math.max.apply(Math,o):0}ee.findHighestImgId=E;var f=function(a){return JSON.stringify(a._fTextNode?{_ifName:a._ifName,_fTextNode:a._fTextNode,_text:a?._text}:{_ifName:a._ifName,_fTextNode:a._fTextNode,_tag:a?._tag,_attrs:a?._attrs})},m=function(a){for(var o=a._parent,n=null;o!=null&&n==null;){var c=o._fTextNode?null:o._tag;if(c==="w:p"){var p=o._parent!=null?o._parent._parent:null;p!=null&&!p._fTextNode&&p._tag==="w:tr"?n=p:n=o}o=o._parent}return n};function d(a,o,n,c){return C(this,void 0,void 0,function(){var p,i,s,h,g,v,t,e,u,r,D,$,F,B,z,Y,ne,q,K,H,le,ue,$,de,we,me,ye,ge,Ce,ge,Ae,De;return k(this,function(ve){switch(ve.label){case 0:p=(0,L.cloneNodeWithoutChildren)(o),i=o,s=p,g=0,v=[],t=0,e=((De=n.options)===null||De===void 0?void 0:De.maximumWalkingDepth)||1e6,ve.label=1;case 1:if(u=(0,L.getCurLoop)(n),r=null,n.fJump){if(!u)throw new w.InternalError("jumping while curLoop is null");_.logger.debug("Jumping to level ".concat(u.refNodeLevel,"..."),f(u.refNode)),g=n.level-u.refNodeLevel,i=u.refNode,n.level=u.refNodeLevel,n.fJump=!1,h="JUMP"}else if(i._children.length&&h!=="UP")i=i._children[0],n.level+=1,h="DOWN";else if(r=(0,L.getNextSibling)(i))i=r,h="SIDE";else{if(D=i._parent,D==null)return _.logger.debug("=== parent is null, breaking after ".concat(t," loops...")),[3,5];if(t>e)throw _.logger.debug("=== parent is still not null after ".concat(t," loops, something must be wrong ..."),f(D)),new w.InternalError("infinite loop or massive dataset detected. Please review and try again");i=D,n.level-=1,h="UP"}if(_.logger.debug("Next node [".concat(h,", level ").concat(n.level,"]"),f(i)),h!=="DOWN"&&($=s._fTextNode?null:s._tag,F=!1,($==="w:p"||$==="w:tbl"||$==="w:tr"||$==="w:tc")&&(0,L.isLoopExploring)(n)?F=!0:($==="w:p"||$==="w:tr"||$==="w:tc")&&(B=n.buffers[$],F=B.text===""&&B.cmds!==""&&!B.fInsertedText,$==="w:tr"&&F&&(F=i._children.filter(function(se){return!se._fTextNode&&se._tag==="w:tr"}).length!==1),$==="w:tc"&&F&&(F=!(s._children.filter(function(se){return!se._fTextNode&&se._tag==="w:tbl"}).length>0))),F&&s._parent!=null&&s._parent._children.pop()),h==="UP"){if((0,L.isLoopExploring)(n)&&u&&i===u.refNode._parent&&(u.refNode=i,u.refNodeLevel-=1,_.logger.debug("Updated loop '".concat(u.varName,"' refNode: ")+f(i))),z=s._parent,z==null)throw new w.InternalError("node parent is null");s=z,n.pendingImageNode&&!s._fTextNode&&s._tag==="w:t"&&(Y=n.pendingImageNode.image,ne=n.pendingImageNode.caption,q=s._parent,q&&(Y._parent=q,q._children.pop(),q._children.push(Y),ne&&(Ae=q._children).push.apply(Ae,ne),n.buffers["w:p"].fInsertedText=!0,n.buffers["w:tr"].fInsertedText=!0,n.buffers["w:tc"].fInsertedText=!0),delete n.pendingImageNode),n.pendingLinkNode&&!s._fTextNode&&s._tag==="w:r"&&(K=n.pendingLinkNode,H=s._parent,H&&(K._parent=H,H._children.pop(),H._children.push(K),n.buffers["w:p"].fInsertedText=!0,n.buffers["w:tr"].fInsertedText=!0,n.buffers["w:tc"].fInsertedText=!0),delete n.pendingLinkNode),n.pendingHtmlNode&&!s._fTextNode&&s._tag==="w:p"&&(le=n.pendingHtmlNode,ue=s._parent,ue&&(le._parent=ue,ue._children.pop(),ue._children.push(le),n.buffers["w:p"].fInsertedText=!0,n.buffers["w:tr"].fInsertedText=!0,n.buffers["w:tc"].fInsertedText=!0),delete n.pendingHtmlNode),!s._fTextNode&&s._tag==="w:tc"&&!s._children.filter(function(se){return!se._fTextNode&&(se._tag==="w:p"||se._tag==="w:altChunk")}).length&&s._children.push({_parent:s,_children:[],_fTextNode:!1,_tag:"w:p",_attrs:{}}),!s._fTextNode&&s._tag==="w:rPr"&&(n.textRunPropsNode=s),!i._fTextNode&&i._tag==="w:r"&&delete n.textRunPropsNode}if(!(h==="DOWN"||h==="SIDE"))return[3,4];if(h==="SIDE"){if(s._parent==null)throw new w.InternalError("node parent is null");s=s._parent}return $=i._fTextNode?null:i._tag,($==="w:p"||$==="w:tr"||$==="w:tc")&&(n.buffers[$]={text:"",cmds:"",fInsertedText:!1}),de=(0,L.cloneNodeWithoutChildren)(i),de._parent=s,s._children.push(de),we=de._tag,!(0,L.isLoopExploring)(n)&&(we==="wp:docPr"||we==="v:shape")&&(_.logger.debug("detected a - ",f(de)),S(de,n)),me=i._parent,i._fTextNode&&me&&!me._fTextNode&&me._tag==="w:t"?[4,x(a,i,n,c)]:[3,3];case 2:ye=ve.sent(),typeof ye=="string"?(de._text=ye,_.logger.debug("Inserted command result string into node. Updated node: "+f(de))):v.push.apply(v,ye),ve.label=3;case 3:s=de,ve.label=4;case 4:if(h==="JUMP")for(;g>0;){if(s._parent==null)throw new w.InternalError("node parent is null");s=s._parent,g-=1}return t++,[3,1];case 5:if(n.gCntIf!==n.gCntEndIf){if(ge=new w.IncompleteConditionalStatementError,n.options.failFast)throw ge;v.push(ge)}if(n.loops.filter(function(se){return!se.isIf}).length>0){if(Ce=n.loops[n.loops.length-1],ge=new w.UnterminatedForLoopError(Ce),n.options.failFast)throw ge;v.push(ge)}return v.length>0?[2,{status:"errors",errors:v}]:[2,{status:"success",report:p,images:n.images,links:n.links,htmls:n.htmls}]}})})}ee.walkTemplate=d;var x=function(a,o,n,c){return C(void 0,void 0,void 0,function(){var p,i,s,h,g,v,t,e,u,r;return k(this,function(D){switch(D.label){case 0:if(p=n.options,i=p.cmdDelimiter,s=p.failFast,h=o._text,h==null||h==="")return[2,""];g=h.split(i[0]).map(function(F){return F.split(i[1])}).reduce(function(F,B){return F.concat(B)}),v="",t=[],e=0,D.label=1;case 1:return e<g.length?(e>0&&N(i[0],n,{fCmd:!0}),u=g[e],n.fCmd?n.cmd+=u:(0,L.isLoopExploring)(n)||(v+=u),N(u,n,{fCmd:n.fCmd}),e<g.length-1?n.fCmd?[4,c(a,o,n)]:[3,3]:[3,4]):[3,5];case 2:if(r=D.sent(),r!=null)if(typeof r=="string")v+=r,N(r,n,{fCmd:!1,fInsertedText:!0});else{if(s)throw r;t.push(r)}D.label=3;case 3:n.fCmd=!n.fCmd,D.label=4;case 4:return e++,[3,1];case 5:return t.length>0?[2,t]:[2,v]}})})},O=function(a,o,n){return C(void 0,void 0,void 0,function(){var c,p,i,s,h,g,v,t,e,u,r,D,F,B,z,Y,ne,q,K;return k(this,function(H){switch(H.label){case 0:c=Q(n.cmd,n.shorthands,n.options.fixSmartQuotes),n.cmd="",p=V(c),i=p.cmdName,s=p.cmdRest,H.label=1;case 1:return H.trys.push([1,28,,29]),i!=="CMD_NODE"&&_.logger.debug("Processing cmd: ".concat(c)),n.fSeekQuery?(i==="QUERY"&&(n.query=s),[2]):i==="QUERY"||i==="CMD_NODE"?[3,27]:[3,2];case 2:if(i!=="ALIAS")return[3,3];if(h=/^(\S+)\s+(.+)/.exec(s),!h)throw new w.InvalidCommandError("Invalid ALIAS command",c);return g=h[1],v=h[2],n.shorthands[g]=v,_.logger.debug("Defined alias '".concat(g,"' for: ").concat(v)),[3,27];case 3:return i==="FOR"||i==="IF"?[4,X(a,o,n,c,i,s)]:[3,5];case 4:return H.sent(),[3,27];case 5:return i==="END-FOR"||i==="END-IF"?(ae(o,n,c,i,s),[3,27]):[3,6];case 6:return i!=="INS"?[3,12]:(0,L.isLoopExploring)(n)?[3,11]:[4,(0,M.runUserJsAndGetRaw)(a,s,n)];case 7:return t=H.sent(),t==null?[2,""]:typeof t=="object"&&!Array.isArray(t)?(e=new w.ObjectCommandResultError(s,t),n.options.errorHandler==null?[3,9]:[4,n.options.errorHandler(e,s)]):[3,10];case 8:return t=H.sent(),[3,10];case 9:throw e;case 10:return u=String(t),n.options.processLineBreaks&&(r=n.options.literalXmlDelimiter,n.options.processLineBreaksAsNewText?(D=u.split(`
`),F="".concat(r,"<w:br/>").concat(r),B="".concat(r,"</w:t>").concat(r),z="".concat(r,'<w:t xml:space="preserve">').concat(r),u=D.join("".concat(B).concat(F).concat(z))):u=u.replace(/\n/g,"".concat(r,"<w:br/>").concat(r))),[2,u];case 11:return[3,27];case 12:return i!=="EXEC"?[3,15]:(0,L.isLoopExploring)(n)?[3,14]:[4,(0,M.runUserJsAndGetRaw)(a,s,n)];case 13:H.sent(),H.label=14;case 14:return[3,27];case 15:return i!=="IMAGE"?[3,18]:(0,L.isLoopExploring)(n)?[3,17]:[4,(0,M.runUserJsAndGetRaw)(a,s,n)];case 16:if(Y=H.sent(),Y!=null)try{be(n,Y)}catch(le){throw(0,w.isError)(le)?new w.ImageError(le,c):le}H.label=17;case 17:return[3,27];case 18:return i!=="LINK"?[3,22]:(0,L.isLoopExploring)(n)?[3,21]:[4,(0,M.runUserJsAndGetRaw)(a,s,n)];case 19:return ne=H.sent(),ne==null?[3,21]:[4,Z(n,ne)];case 20:H.sent(),H.label=21;case 21:return[3,27];case 22:return i!=="HTML"?[3,26]:(0,L.isLoopExploring)(n)?[3,25]:[4,(0,M.runUserJsAndGetRaw)(a,s,n)];case 23:return q=H.sent(),q==null?[3,25]:[4,y(n,q)];case 24:H.sent(),H.label=25;case 25:return[3,27];case 26:throw new w.CommandSyntaxError(c);case 27:return[2];case 28:if(K=H.sent(),!(0,w.isError)(K))throw K;return n.options.errorHandler!=null?[2,n.options.errorHandler(K,s)]:[2,K];case 29:return[2]}})})},W=A.BUILT_IN_COMMANDS.map(function(a){return new RegExp("^".concat(a,"\\b"))}),j=function(a){return!W.some(function(o){return o.test(a.toUpperCase())})};function Q(a,o,n){var c=a.trim();if(c[0]==="*"){var p=c.slice(1).trim();if(!o[p])throw new w.InvalidCommandError("Unknown alias",c);c=o[p],_.logger.debug("Alias for: ".concat(c))}else c[0]==="="?c="INS ".concat(c.slice(1).trim()):c[0]==="!"?c="EXEC ".concat(c.slice(1).trim()):j(c)&&(c="INS ".concat(c.trim()));return n&&(c=c.replace(/[\u201C\u201D\u201E]/g,'"').replace(/[\u2018\u2019\u201A]/g,"'")),c.trim()}ee.getCommand=Q;function V(a){var o=/^(\S+)\s*/.exec(a),n,c="";return o!=null&&(n=o[1].toUpperCase(),c=a.slice(n.length).trim()),{cmdName:n,cmdRest:c}}ee.splitCommand=V;var X=function(a,o,n,c,p,i){return C(void 0,void 0,void 0,function(){var s,h,g,v,t,e,u,r,D,F;return k(this,function(B){switch(B.label){case 0:if(s=p==="IF",h=null,g=void 0,s)o._ifName||(o._ifName="__if_".concat(n.gCntIf),n.gCntIf+=1),g=o._ifName;else{if(h=/^(\S+)\s+IN\s+(.+)/i.exec(i),!h)throw new w.InvalidCommandError("Invalid FOR command",c);g=h[1]}if(v=(0,L.getCurLoop)(n),v&&v.varName===g)return[3,6];if(s&&(t=m(o),e=t!=null?t._fTextNode?null:t._tag:null,t!=null)){if(e==="w:p"){if(n.pIfCheckMap.has(t)&&n.pIfCheckMap.get(t)!==c)throw new w.InvalidCommandError("Invalid IF command nested into another IF command on the same line",c);n.pIfCheckMap.set(t,c)}else if(e==="w:tr"){if(n.trIfCheckMap.has(t)&&n.trIfCheckMap.get(t)!==c)throw new w.InvalidCommandError("Invalid IF command nested into another IF command on the same table row",c);n.trIfCheckMap.set(t,c)}}return u=n.loops.length-1,r=u>=0&&n.loops[u].idx===-1,D=void 0,r?(D=[],[3,5]):[3,1];case 1:return s?[4,(0,M.runUserJsAndGetRaw)(a,i,n)]:[3,3];case 2:return F=!!B.sent(),D=F?[1]:[],[3,5];case 3:if(!h)throw new w.InvalidCommandError("Invalid FOR command",c);return[4,(0,M.runUserJsAndGetRaw)(a,h[2],n)];case 4:if(D=B.sent(),!Array.isArray(D))throw new w.InvalidCommandError("Invalid FOR command (can only iterate over Array)",c);B.label=5;case 5:n.loops.push({refNode:o,refNodeLevel:n.level,varName:g,loopOver:D,isIf:s,idx:-1}),B.label=6;case 6:return(0,L.logLoop)(n.loops),[2]}})})},ae=function(a,o,n,c,p){var i=c==="END-IF",s=(0,L.getCurLoop)(o);if(!s)throw new w.InvalidCommandError("Unexpected ".concat(c," outside of ").concat(i?"IF statement":"FOR loop"," context"),n);var h=m(a),g=h!=null?h._fTextNode?null:h._tag:null;g==="w:p"?o.pIfCheckMap.delete(h):g==="w:tr"&&o.trIfCheckMap.delete(h),i&&!a._ifName&&(a._ifName=s.varName,o.gCntEndIf+=1);var v=i?a._ifName:p;if(s.varName!==v){if(o.loops.find(function(u){return u.varName===v})==null){_.logger.debug("Ignoring ".concat(n," (").concat(v,", but we're expecting ").concat(s.varName,")"));return}throw new w.InvalidCommandError("Invalid command",n)}var t=s.idx+1,e=s.loopOver[t];e!=null?(o.vars[v]=e,o.fJump=!0,s.idx=t):o.loops.pop()},G=function(a,o){oe(o),a.imageAndShapeIdIncrement+=1;var n=String(a.imageAndShapeIdIncrement),c="img".concat(n);return a.images[c]=o,c};function oe(a){if(!(a.data instanceof Uint8Array||a.data instanceof ArrayBuffer||typeof a.data=="string"))throw new Error("image .data property needs to be provided as Uint8Array (e.g. Buffer), ArrayBuffer, or as a base64-encoded string");if(!A.ImageExtensions.includes(a.extension))throw new Error("An extension (one of ".concat(A.ImageExtensions,") needs to be provided when providing an image or a thumbnail."))}function l(a){if(!Number.isFinite(a.width))throw new Error("invalid image width: ".concat(a.width," (in cm)"));if(!Number.isFinite(a.height))throw new Error("invalid image height: ".concat(a.height," (in cm)"));oe(a),a.thumbnail&&oe(a.thumbnail)}var be=function(a,o){var n;l(o);var c=(o.width*36e4).toFixed(0),p=(o.height*36e4).toFixed(0),i=G(a,pe(o)),s=String(a.imageAndShapeIdIncrement),h=o.alt||"",g=L.newNonTextNode,v=[];v.push(g("a:ext",{uri:"{28A0092B-C50C-407E-A947-70E740481C1C}"},[g("a14:useLocalDpi",{"xmlns:a14":"http://schemas.microsoft.com/office/drawing/2010/main",val:"0"})]));var t=o.rotation?(o.rotation*6e4).toString():void 0;if(a.images[i].extension===".svg"){var e=(n=o.thumbnail)!==null&&n!==void 0?n:{data:"bm90aGluZwo=",extension:".png"},u=G(a,e);v.push(g("a:ext",{uri:"{96DAC541-7B7A-43D3-8B79-37D633B846F1}"},[g("asvg:svgBlip",{"xmlns:asvg":"http://schemas.microsoft.com/office/drawing/2016/SVG/main","r:embed":i})])),i=u}var r=g("pic:pic",{"xmlns:pic":"http://schemas.openxmlformats.org/drawingml/2006/picture"},[g("pic:nvPicPr",{},[g("pic:cNvPr",{id:"0",name:"Picture ".concat(s),descr:h}),g("pic:cNvPicPr",{},[g("a:picLocks",{noChangeAspect:"1",noChangeArrowheads:"1"})])]),g("pic:blipFill",{},[g("a:blip",{"r:embed":i,cstate:"print"},[g("a:extLst",{},v)]),g("a:srcRect"),g("a:stretch",{},[g("a:fillRect")])]),g("pic:spPr",{bwMode:"auto"},[g("a:xfrm",t?{rot:t}:{},[g("a:off",{x:"0",y:"0"}),g("a:ext",{cx:c,cy:p})]),g("a:prstGeom",{prst:"rect"},[g("a:avLst")]),g("a:noFill"),g("a:ln",{},[g("a:noFill")])])]),D=g("w:drawing",{},[g("wp:inline",{distT:"0",distB:"0",distL:"0",distR:"0"},[g("wp:extent",{cx:c,cy:p}),g("wp:docPr",{id:s,name:"Picture ".concat(s),descr:h}),g("wp:cNvGraphicFramePr",{},[g("a:graphicFrameLocks",{"xmlns:a":"http://schemas.openxmlformats.org/drawingml/2006/main",noChangeAspect:"1"})]),g("a:graphic",{"xmlns:a":"http://schemas.openxmlformats.org/drawingml/2006/main"},[g("a:graphicData",{uri:"http://schemas.openxmlformats.org/drawingml/2006/picture"},[r])])])]);a.pendingImageNode={image:D},o.caption&&(a.pendingImageNode.caption=[g("w:br"),g("w:t",{},[(0,L.newTextNode)(o.caption)])])};function pe(a){var o=a.data,n=a.extension;if(!n)throw new Error("If you return image `data`, make sure you return an extension as well!");return{extension:n,data:o}}var Z=function(a,o){return C(void 0,void 0,void 0,function(){var n,c,p,i,s,h,g,v;return k(this,function(t){return n=o.url,c=o.label,p=c===void 0?n:c,a.linkId+=1,i=String(a.linkId),s="link".concat(i),a.links[s]={url:n},h=L.newNonTextNode,g=a.textRunPropsNode,v=h("w:hyperlink",{"r:id":s,"w:history":"1"},[h("w:r",{},[g||h("w:rPr",{},[h("w:u",{"w:val":"single"})]),h("w:t",{},[(0,L.newTextNode)(p)])])]),a.pendingLinkNode=v,[2]})})},y=function(a,o){return C(void 0,void 0,void 0,function(){var n,c,p,i;return k(this,function(s){return a.htmlId+=1,n=String(a.htmlId),c="html".concat(n),a.htmls[c]=o,p=L.newNonTextNode,i=p("w:altChunk",{"r:id":c}),a.pendingHtmlNode=i,[2]})})},P=["w:p","w:tr","w:tc"],N=function(a,o,n){if(!o.fSeekQuery){var c=n.fCmd,p=n.fInsertedText,i=c?"cmds":"text";P.forEach(function(s){var h=o.buffers[s];h[i]+=a,p&&(h.fInsertedText=!0)})}};function S(a,o){o.imageAndShapeIdIncrement+=1;var n=String(o.imageAndShapeIdIncrement);a._attrs=I(I({},a._attrs),{id:"".concat(n)})}return ee}var rt;function at(){if(rt)return te;rt=1;var I=te&&te.__awaiter||function(y,P,N,S){function a(o){return o instanceof N?o:new N(function(n){n(o)})}return new(N||(N=Promise))(function(o,n){function c(s){try{i(S.next(s))}catch(h){n(h)}}function p(s){try{i(S.throw(s))}catch(h){n(h)}}function i(s){s.done?o(s.value):a(s.value).then(c,p)}i((S=S.apply(y,P||[])).next())})},C=te&&te.__generator||function(y,P){var N={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},S,a,o,n;return n={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(n[Symbol.iterator]=function(){return this}),n;function c(i){return function(s){return p([i,s])}}function p(i){if(S)throw new TypeError("Generator is already executing.");for(;n&&(n=0,i[0]&&(N=0)),N;)try{if(S=1,a&&(o=i[0]&2?a.return:i[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,i[1])).done)return o;switch(a=0,o&&(i=[i[0]&2,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return N.label++,{value:i[1],done:!1};case 5:N.label++,a=i[1],i=[0];continue;case 7:i=N.ops.pop(),N.trys.pop();continue;default:if(o=N.trys,!(o=o.length>0&&o[o.length-1])&&(i[0]===6||i[0]===2)){N=0;continue}if(i[0]===3&&(!o||i[1]>o[0]&&i[1]<o[3])){N.label=i[1];break}if(i[0]===6&&N.label<o[1]){N.label=o[1],o=i;break}if(o&&N.label<o[2]){N.label=o[2],N.ops.push(i);break}o[2]&&N.ops.pop(),N.trys.pop();continue}i=P.call(y,N)}catch(s){i=[6,s],a=0}finally{S=o=0}if(i[0]&5)throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},k=te&&te.__spreadArray||function(y,P,N){if(N||arguments.length===2)for(var S=0,a=P.length,o;S<a;S++)(o||!(S in P))&&(o||(o=Array.prototype.slice.call(P,0,S)),o[S]=P[S]);return y.concat(o||Array.prototype.slice.call(P))},L=te&&te.__importDefault||function(y){return y&&y.__esModule?y:{default:y}};Object.defineProperty(te,"__esModule",{value:!0}),te.getMainDoc=te.readContentTypes=te.getMetadata=te.listCommands=te.parseTemplate=void 0;var M=mt(),A=gt(),w=L(ht()),_=Tt(),b=je(),R=Re(),T=Le(),E="+++",f="||",m="[Content_Types].xml",d="word",x=new RegExp("".concat(d,"\\/[^\\/]+\\.xml"));function O(y){return I(this,void 0,void 0,function(){var P,N,S,a,o,n,c,p,i;return C(this,function(s){switch(s.label){case 0:return T.logger.debug("Unzipping..."),[4,(0,M.zipLoad)(y)];case 1:return P=s.sent(),T.logger.debug("finding main template file (e.g. document.xml)"),[4,ae(P)];case 2:return N=s.sent(),S=G(N),a="".concat(d,"/").concat(S),T.logger.debug("Reading ".concat(a,"...")),[4,(0,M.zipGetText)(P,a)];case 3:if(o=s.sent(),o==null)throw new R.TemplateParseError("".concat(S," could not be found"));return T.logger.debug("".concat(a," file length: ").concat(o.length)),T.logger.debug("Parsing ".concat(a," XML...")),n=new Date().getTime(),[4,(0,A.parseXml)(o)];case 4:return c=s.sent(),p=c,i=new Date().getTime(),T.logger.debug("".concat(a," parsed in ").concat(i-n," ms")),[2,{jsTemplate:p,mainDocument:S,zip:P,contentTypes:N}]}})})}te.parseTemplate=O;function W(y,P,N){return I(this,void 0,void 0,function(){var S,a,o,n,c,p,i,s,h=this;return C(this,function(g){switch(g.label){case 0:S=[],y.forEach(function(v){return I(h,void 0,void 0,function(){return C(this,function(t){return x.test(v)&&v!=="".concat(d,"/").concat(P)&&v.indexOf("".concat(d,"/template"))!==0&&S.push(v),[2]})})}),S.sort(),a=[],o=0,n=S,g.label=1;case 1:return o<n.length?(c=n[o],T.logger.debug("Reading ".concat(c,"...")),[4,(0,M.zipGetText)(y,c)]):[3,5];case 2:if(p=g.sent(),p==null)throw new R.TemplateParseError("".concat(c," could not be read"));return T.logger.debug("".concat(c," file length: ").concat(p.length)),T.logger.debug("Parsing ".concat(c," XML...")),[4,(0,A.parseXml)(p)];case 3:i=g.sent(),s=(0,w.default)(i,N.cmdDelimiter,N.preserveSpace),a.push([s,c]),g.label=4;case 4:return o++,[3,1];case 5:return[2,a]}})})}function j(y,P){return I(this,void 0,void 0,function(){var N,S,a,o,n,c,p,i,s,h,g,v,t,e,u,r,D,F,B,z,Y,ne,q,K,H,le,ue,$,de,we,me,ye,Ce,ge,Ae,De,ve,se,Ne,Ve,He,Me,Be,Ue;return C(this,function(ie){switch(ie.label){case 0:return T.logger.debug("Report options:",{attach:y}),N=y.template,S=y.data,a=y.queryVars,o=y.literalXmlDelimiter||f,n={cmdDelimiter:Z(y.cmdDelimiter),literalXmlDelimiter:o,processLineBreaks:y.processLineBreaks!=null?y.processLineBreaks:!0,noSandbox:y.noSandbox||!1,runJs:y.runJs,additionalJsContext:y.additionalJsContext||{},failFast:y.failFast==null?!0:y.failFast,rejectNullish:y.rejectNullish==null?!1:y.rejectNullish,errorHandler:typeof y.errorHandler=="function"?y.errorHandler:null,fixSmartQuotes:y.fixSmartQuotes==null?!1:y.fixSmartQuotes,processLineBreaksAsNewText:y.processLineBreaksAsNewText==null?!1:y.processLineBreaksAsNewText,maximumWalkingDepth:y.maximumWalkingDepth,indentXml:(Me=y.indentXml)!==null&&Me!==void 0?Me:!0,preserveSpace:(Be=y.preserveSpace)!==null&&Be!==void 0?Be:!0,compressionLevel:(Ue=y.compressionLevel)!==null&&Ue!==void 0?Ue:1},c={literalXmlDelimiter:o,indentXml:n.indentXml},[4,O(N)];case 1:return p=ie.sent(),i=p.jsTemplate,s=p.mainDocument,h=p.zip,g=p.contentTypes,T.logger.debug("Preprocessing template..."),v=(0,w.default)(i,n.cmdDelimiter,n.preserveSpace),t=null,typeof S!="function"?[3,4]:(T.logger.debug("Looking for the query in the template..."),[4,(0,_.extractQuery)(v,n)]);case 2:return e=ie.sent(),T.logger.debug("Query: ".concat(e||"no query found")),[4,S(e,a)];case 3:return t=ie.sent(),[3,5];case 4:t=S,ie.label=5;case 5:return[4,W(h,s,n)];case 6:return u=ie.sent(),r=Math.max.apply(Math,k(k([],u.map(function(Ie){var ke=Ie[0];return Ie[1],(0,_.findHighestImgId)(ke)}),!1),[(0,_.findHighestImgId)(v)],!1)),T.logger.debug("Generating report..."),D=(0,_.newContext)(n,r),[4,(0,_.produceJsReport)(t,v,D)];case 7:if(F=ie.sent(),F.status==="errors")throw F.errors;return B=F.report,z=F.images,Y=F.links,ne=F.htmls,P==="JS"?[2,B]:(T.logger.debug("Converting report to XML..."),q=(0,A.buildXml)(B,c),P==="XML"?[2,q.toString("utf-8")]:(T.logger.debug("Writing report..."),(0,M.zipSetText)(h,"".concat(d,"/").concat(s),q),K=Object.keys(z).length,H=Object.keys(ne).length,[4,oe(z,s,h,n.indentXml)]));case 8:return ie.sent(),[4,l(Y,s,h,n.indentXml)];case 9:return ie.sent(),[4,be(ne,s,h,n.indentXml)];case 10:ie.sent(),le=0,ue=u,ie.label=11;case 11:return le<ue.length?($=ue[le],de=$[0],we=$[1],D=(0,_.newContext)(n,D.imageAndShapeIdIncrement),[4,(0,_.produceJsReport)(t,de,D)]):[3,17];case 12:if(me=ie.sent(),me.status==="errors")throw me.errors;return ye=me.report,Ce=me.images,ge=me.links,Ae=me.htmls,De=(0,A.buildXml)(ye,c),(0,M.zipSetText)(h,we,De),K+=Object.keys(Ce).length,H+=Object.keys(Ae).length,ve=we.split("/"),se=ve[ve.length-1],[4,oe(Ce,se,h,n.indentXml)];case 13:return ie.sent(),[4,l(ge,s,h,n.indentXml)];case 14:return ie.sent(),[4,be(Ae,s,h,n.indentXml)];case 15:ie.sent(),ie.label=16;case 16:return le++,[3,11];case 17:return(K||H)&&(T.logger.debug("Completing [Content_Types].xml..."),T.logger.debug("Content types",{attach:g}),Ne=function(Ie,ke){var ot=g._children;ot.filter(function(ze){var Xe;return!ze._fTextNode&&((Xe=ze._attrs.Extension)===null||Xe===void 0?void 0:Xe.toLowerCase())===Ie?.toLowerCase()}).length||(0,b.addChild)(g,(0,b.newNonTextNode)("Default",{Extension:Ie,ContentType:ke}))},K&&(T.logger.debug("Completing [Content_Types].xml for IMAGES..."),Ne("png","image/png"),Ne("jpg","image/jpeg"),Ne("jpeg","image/jpeg"),Ne("gif","image/gif"),Ne("bmp","image/bmp"),Ne("svg","image/svg+xml")),H&&(T.logger.debug("Completing [Content_Types].xml for HTML..."),Ne("html","text/html")),Ve=(0,A.buildXml)(g,c),(0,M.zipSetText)(h,m,Ve)),T.logger.debug("Zipping..."),[4,(0,M.zipSave)(h,n.compressionLevel)];case 18:return He=ie.sent(),[2,He]}})})}function Q(y,P){return I(this,void 0,void 0,function(){var N,S,a,o,n,c,p,i,s,h,g,v,t,e=this;return C(this,function(u){switch(u.label){case 0:return N={cmdDelimiter:Z(P),literalXmlDelimiter:f,processLineBreaks:!0,noSandbox:!1,additionalJsContext:{},failFast:!1,rejectNullish:!1,errorHandler:null,fixSmartQuotes:!1,processLineBreaksAsNewText:!1,indentXml:!0,preserveSpace:!0,compressionLevel:1},[4,O(y)];case 1:return S=u.sent(),a=S.jsTemplate,o=S.mainDocument,n=S.zip,[4,W(n,o,N)];case 2:c=u.sent(),p=k([a],c.map(function(r){var D=r[0];return r[1],D}),!0),i=[],s=0,h=p,u.label=3;case 3:return s<h.length?(g=h[s],v=(0,w.default)(g,N.cmdDelimiter,N.preserveSpace),t=(0,_.newContext)(N),[4,(0,_.walkTemplate)(void 0,v,t,function(r,D,F){return I(e,void 0,void 0,function(){var B,z,Y,ne,q;return C(this,function(K){return B=(0,_.getCommand)(F.cmd,F.shorthands,F.options.fixSmartQuotes),F.cmd="",z=(0,_.splitCommand)(B),Y=z.cmdName,ne=z.cmdRest,q=Y,q!=null&&q!=="CMD_NODE"&&i.push({raw:B,type:q,code:ne}),[2,void 0]})})})]):[3,6];case 4:u.sent(),u.label=5;case 5:return s++,[3,3];case 6:return[2,i]}})})}te.listCommands=Q;function V(y){return I(this,void 0,void 0,function(){function P(i){if(i._children.length!==0){var s=i._children[0];if(s._fTextNode)return s._text;throw new Error("Not a text node")}}function N(i,s){for(var h=0,g=i._children;h<g.length;h++){var v=g[h];if(!v._fTextNode&&v._tag===s)return P(v)}}var S,a,o,n,c,p;return C(this,function(i){switch(i.label){case 0:return S="docProps/app.xml",a="docProps/core.xml",[4,(0,M.zipLoad)(y)];case 1:return o=i.sent(),[4,X(o,S)];case 2:return n=i.sent(),[4,X(o,a)];case 3:return c=i.sent(),p=function(s){var h=Number(s);if(Number.isFinite(h))return h},[2,{pages:p(N(n,"Pages")),words:p(N(n,"Words")),characters:p(N(n,"Characters")),lines:p(N(n,"Lines")),paragraphs:p(N(n,"Paragraphs")),company:N(n,"Company"),template:N(n,"Template"),title:N(c,"dc:title"),subject:N(c,"dc:subject"),creator:N(c,"dc:creator"),description:N(c,"dc:description"),lastModifiedBy:N(c,"cp:lastModifiedBy"),revision:N(c,"cp:revision"),lastPrinted:N(c,"cp:lastPrinted"),created:N(c,"dcterms:created"),modified:N(c,"dcterms:modified"),category:N(c,"cp:category")}]}})})}te.getMetadata=V;function X(y,P){return I(this,void 0,void 0,function(){var N,S;return C(this,function(a){switch(a.label){case 0:return[4,(0,M.zipGetText)(y,P)];case 1:if(N=a.sent(),N==null)throw new R.TemplateParseError("".concat(P," could not be read"));return[4,(0,A.parseXml)(N)];case 2:if(S=a.sent(),S._fTextNode)throw new R.TemplateParseError("".concat(P," is a text node when parsed"));return[2,S]}})})}function ae(y){return I(this,void 0,void 0,function(){return C(this,function(P){switch(P.label){case 0:return[4,X(y,m)];case 1:return[2,P.sent()]}})})}te.readContentTypes=ae;function G(y){for(var P=["application/vnd.openxmlformats-officedocument.wordprocessingml.document.main+xml","application/vnd.ms-word.document.macroEnabled.main+xml"],N=0,S=y._children;N<S.length;N++){var a=S[N];if(!a._fTextNode&&a._attrs.ContentType!=null&&P.includes(a._attrs.ContentType)){var o=a._attrs.PartName;if(o)return o.replace("/word/","")}}throw new R.TemplateParseError("Could not find main document (e.g. document.xml) in ".concat(m))}te.getMainDoc=G;var oe=function(y,P,N,S){return I(void 0,void 0,void 0,function(){var a,o,n,c,p,i,s,h,g,v,t,e;return C(this,function(u){switch(u.label){case 0:return T.logger.debug("Processing images for ".concat(P,"...")),a=Object.keys(y),a.length?(T.logger.debug("Completing document.xml.rels..."),o="".concat(d,"/_rels/").concat(P,".rels"),[4,pe(N,o)]):[2];case 1:for(n=u.sent(),c=0,p=a;c<p.length;c++)i=p[c],s=y[i],h=s.extension,g=s.data,v="template_".concat(P,"_").concat(i).concat(h),T.logger.debug("Writing image ".concat(i," (").concat(v,")...")),t="".concat(d,"/media/").concat(v),typeof g=="string"?N.file(t,g,{base64:!0}):N.file(t,g,{binary:!0}),(0,b.addChild)(n,(0,b.newNonTextNode)("Relationship",{Id:i,Type:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image",Target:"media/".concat(v)}));return e=(0,A.buildXml)(n,{literalXmlDelimiter:f,indentXml:S}),(0,M.zipSetText)(N,o,e),[2]}})})},l=function(y,P,N,S){return I(void 0,void 0,void 0,function(){var a,o,n,c,p,i,s,h;return C(this,function(g){switch(g.label){case 0:return T.logger.debug("Processing links for ".concat(P,"...")),a=Object.keys(y),a.length?(T.logger.debug("Completing document.xml.rels..."),o="".concat(d,"/_rels/").concat(P,".rels"),[4,pe(N,o)]):[3,2];case 1:for(n=g.sent(),c=0,p=a;c<p.length;c++)i=p[c],s=y[i].url,(0,b.addChild)(n,(0,b.newNonTextNode)("Relationship",{Id:i,Type:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink",Target:s,TargetMode:"External"}));h=(0,A.buildXml)(n,{literalXmlDelimiter:f,indentXml:S}),(0,M.zipSetText)(N,o,h),g.label=2;case 2:return[2]}})})},be=function(y,P,N,S){return I(void 0,void 0,void 0,function(){var a,o,n,c,p,i,s,h,g,v,t;return C(this,function(e){switch(e.label){case 0:return T.logger.debug("Processing htmls for ".concat(P,"...")),a=Object.keys(y),a.length?(T.logger.debug("Completing document.xml.rels..."),o=[],n="".concat(d,"/_rels/").concat(P,".rels"),[4,pe(N,n)]):[3,2];case 1:for(c=e.sent(),p=0,i=a;p<i.length;p++)s=i[p],h=y[s],g="template_".concat(P.replace(/\./g,"_"),"_").concat(s,".html"),T.logger.debug("Writing html ".concat(s," (").concat(g,")...")),v="".concat(d,"/").concat(g),o.push("/".concat(v)),(0,M.zipSetText)(N,v,Ee.from(h)),(0,b.addChild)(c,(0,b.newNonTextNode)("Relationship",{Id:s,Type:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/aFChunk",Target:"".concat(g)}));t=(0,A.buildXml)(c,{literalXmlDelimiter:f,indentXml:S}),(0,M.zipSetText)(N,n,t),e.label=2;case 2:return[2]}})})},pe=function(y,P){return I(void 0,void 0,void 0,function(){var N;return C(this,function(S){switch(S.label){case 0:return[4,(0,M.zipGetText)(y,P)];case 1:return N=S.sent(),N||(N=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
        <Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">
        </Relationships>`),[2,(0,A.parseXml)(N)]}})})},Z=function(y){return y?typeof y=="string"?[y,y]:y:[E,E]};return te.default=j,te}var it;function Et(){return it||(it=1,(function(I){var C=_e&&_e.__createBinding||(Object.create?(function(w,_,b,R){R===void 0&&(R=b);var T=Object.getOwnPropertyDescriptor(_,b);(!T||("get"in T?!_.__esModule:T.writable||T.configurable))&&(T={enumerable:!0,get:function(){return _[b]}}),Object.defineProperty(w,R,T)}):(function(w,_,b,R){R===void 0&&(R=b),w[R]=_[b]})),k=_e&&_e.__exportStar||function(w,_){for(var b in w)b!=="default"&&!Object.prototype.hasOwnProperty.call(_,b)&&C(_,w,b)},L=_e&&_e.__importDefault||function(w){return w&&w.__esModule?w:{default:w}};Object.defineProperty(I,"__esModule",{value:!0}),I.createReport=I.getMetadata=I.listCommands=void 0;var M=L(at());I.createReport=M.default;var A=at();Object.defineProperty(I,"listCommands",{enumerable:!0,get:function(){return A.listCommands}}),Object.defineProperty(I,"getMetadata",{enumerable:!0,get:function(){return A.getMetadata}}),k(Re(),I),I.default=M.default})(_e)),_e}var Nt=Et();const St=()=>{const[I,C]=he.useState(Se.companyAddress),[k,L]=he.useState(Se.companyPhoneNumber),[M,A]=he.useState(Se.companyName),[w,_]=he.useState(Se.clientCompanyName),[b,R]=he.useState(Se.clientAddress),[T,E]=he.useState(Se.clientPhoneNumber),[f,m]=he.useState(null),[d,x]=he.useState(null),O=he.useRef(null),W=he.useCallback(async()=>{if(f)try{const X={companyAddress:I,companyPhoneNumber:k,companyName:M,clientCompanyName:w,clientAddress:b,clientPhoneNumber:T},ae=await Nt.createReport({template:f,data:X,cmdDelimiter:["{","}"],noSandbox:!0});x(ae);const G=new Blob([ae],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});if(O.current){O.current.innerHTML="",await ft(G,O.current);const oe=document.createElement("style");oe.textContent=`
          .docx-wrapper * { text-align: left !important; }
          .docx-wrapper table { margin: 0 auto; }
        `,O.current.appendChild(oe)}}catch(X){console.error("Error generating document:",X),alert("Error generating document. Please check the inputs.")}},[f,I,k,M,w,b,T]),j=async X=>{const ae=X.target.files?.[0];if(ae&&ae.name.endsWith(".docx"))try{const G=await ae.arrayBuffer(),oe=new Uint8Array(G);m(oe),x(null)}catch(G){console.error("Error loading docx:",G),alert("Error loading the document. Please check the file.")}else alert("Please select a valid .docx file.")},Q=()=>{if(!d)return;const X=new Blob([d],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}),ae=URL.createObjectURL(X),G=document.createElement("a");G.href=ae,G.download="filled_document.docx",document.body.appendChild(G),G.click(),document.body.removeChild(G),URL.revokeObjectURL(ae)},V=()=>{const X=document.createElement("a");X.href=dt,X.download="INVOICE.docx",document.body.appendChild(X),X.click(),document.body.removeChild(X)};return U.jsxs("div",{style:{textAlign:"left"},children:[U.jsx("h1",{className:"text-3xl font-medium mb-6",children:"Templating for docx file with docx-templates"}),U.jsxs("h3",{style:{fontWeight:"bold",marginBottom:"20px"},children:["docx file generated by","  ",U.jsx("a",{href:"https://www.npmjs.com/package/docx-templates",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800",children:U.jsx("em",{children:"docx-templates"})})," ","package"]}),U.jsxs("p",{style:{marginBottom:"20px"},children:["Standard tags like ",U.jsx("b",{children:"{firstName}"})," are replaced with the corresponding string value from your JSON data."]}),U.jsxs("div",{style:{marginBottom:"52px"},children:[U.jsxs("div",{style:{marginBottom:"16px"},children:[U.jsx("h4",{style:{marginBottom:"10px",fontWeight:"bold"},children:"Company Information"}),U.jsxs("div",{style:{display:"flex",gap:"20px"},children:[U.jsx("div",{style:{flex:1},children:U.jsxs("label",{children:["Company Name:",U.jsx(Oe,{type:"text",value:M,onChange:X=>A(X.target.value)})]})}),U.jsx("div",{style:{flex:1},children:U.jsxs("label",{children:["Company Address:",U.jsx(Oe,{type:"text",value:I,onChange:X=>C(X.target.value)})]})}),U.jsx("div",{style:{flex:1},children:U.jsxs("label",{children:["Company Phone Number:",U.jsx(Oe,{type:"tel",value:k,onChange:X=>L(X.target.value)})]})})]})]}),U.jsxs("div",{style:{marginTop:"24px"},children:[U.jsx("h4",{style:{marginBottom:"10px",fontWeight:"bold"},children:"Client Information"}),U.jsxs("div",{style:{display:"flex",gap:"20px"},children:[U.jsx("div",{style:{flex:1},children:U.jsxs("label",{children:["Client Company Name:",U.jsx(Oe,{type:"text",value:w,onChange:X=>_(X.target.value)})]})}),U.jsx("div",{style:{flex:1},children:U.jsxs("label",{children:["Client Address:",U.jsx(Oe,{type:"text",value:b,onChange:X=>R(X.target.value)})]})}),U.jsx("div",{style:{flex:1},children:U.jsxs("label",{children:["Client Phone Number:",U.jsx(Oe,{type:"tel",value:T,onChange:X=>E(X.target.value)})]})})]})]})]}),U.jsx("p",{style:{marginBottom:"20px"},children:U.jsx(Fe,{onClick:V,variant:"outline",children:"Download example DOCX template with variables"})}),U.jsx("input",{type:"file",accept:".docx",onChange:j,style:{display:"none"},id:"docx-upload"}),U.jsxs("div",{style:{marginBottom:"24px",display:"flex",gap:"12px",justifyContent:"flex-start"},children:[U.jsx(Fe,{onClick:()=>document.getElementById("docx-upload")?.click(),variant:"outline",children:"Choose DOCX File"}),U.jsx(Fe,{onClick:W,disabled:!f,children:"Generate Document"}),U.jsx(Fe,{onClick:Q,disabled:!d,children:"Download Filled Document"})]}),U.jsxs("h3",{style:{fontWeight:"bold",marginBottom:"24px"},children:["Preview by"," ",U.jsx("a",{href:"https://www.npmjs.com/package/docx-preview",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800",children:U.jsx("em",{children:"docx-preview"})})," ","package"]}),U.jsx("div",{ref:O,style:{border:"1px solid #ccc",padding:"20px",minHeight:"500px"}})]})};export{St as default};
